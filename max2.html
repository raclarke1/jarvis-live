<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Max2 Trading Dashboard</title>
  <style>
    body {
      background-color: #0a0a0f;
      color: #e4e4e7;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .badge {
      background-color: #00ff88;
      color: #000;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
    }
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .card {
      background-color: #1a1a2e;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .card-title {
      font-size: 0.9rem;
      color: #71717a;
      margin-bottom: 8px;
    }
    .card-value {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .section-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1a1a2e;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 32px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #2a2a3e;
    }
    th {
      background-color: #25253a;
      color: #a1a1aa;
      font-size: 0.85rem;
      text-transform: uppercase;
    }
    .long { color: #00ff88; }
    .short { color: #ff4757; }
    .profit { color: #00ff88; }
    .loss { color: #ff4757; }
    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.9rem;
    }
    .footer a {
      color: #58a6ff;
      text-decoration: none;
    }
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      table {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Max2 Trading System</h1>
      <span class="badge" id="statusBadge" style="background:#00c853">LIVE</span>
      <div>
        <span class="card-title">Total Equity:</span>
        <span id="totalEquity" class="card-value">--</span>
      </div>
      <div>
        <span class="card-title">Overall P&L:</span>
        <span id="overallPnl" class="card-value">--</span>
      </div>
    </div>

    <div class="card-container">
      <div class="card">
        <div class="card-title">Sub0 Equity</div>
        <div id="sub0Equity" class="card-value">--</div>
      </div>
      <div class="card">
        <div class="card-title">Sub1 Equity</div>
        <div id="sub1Equity" class="card-value">--</div>
      </div>
      <div class="card">
        <div class="card-title">Total Leverage</div>
        <div id="totalLeverage" class="card-value">--</div>
      </div>
      <div class="card">
        <div class="card-title">Free Collateral</div>
        <div id="freeCollateral" class="card-value">--</div>
      </div>
    </div>

    <h2 class="section-title">Open Positions</h2>
    <table id="positionsTable">
      <thead>
        <tr>
          <th>Asset</th>
          <th>Direction</th>
          <th>Strategy</th>
          <th>Entry</th>
          <th>Current</th>
          <th>P&L</th>
          <th>SL</th>
          <th>TP</th>
          <th>Subaccount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2 class="section-title">Orders</h2>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>Asset</th>
          <th>Type</th>
          <th>Direction</th>
          <th>Trigger</th>
          <th>Condition</th>
          <th>Size</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2 class="section-title">Trade History</h2>
    <table id="historyTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Asset</th>
          <th>Direction</th>
          <th>Strategy</th>
          <th>Entry</th>
          <th>Exit</th>
          <th>P&L</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="footer">
      <a href="https://app.drift.trade/overview?authority=3gPExFYHC8fqkwwrb6De8n9fwYdbJPBG3XYLstKNNkt7" target="_blank">View Drift Account</a>
    </div>
  </div>

  <script>
    async function loadData() {
      try {
        const response = await fetch('state-max2.json');
        const data = await response.json();

        // Header
        document.getElementById('statusBadge').textContent = data.status;
        document.getElementById('totalEquity').textContent = '$' + data.account.totalEquity.toLocaleString();
        // Overall P&L - assuming it's accountPnl or calculate from starting
        const overallPnl = data.account.totalEquity - data.account.startingEquity;
        document.getElementById('overallPnl').textContent = (overallPnl >= 0 ? '+' : '') + '$' + overallPnl.toLocaleString();
        document.getElementById('overallPnl').classList.add(overallPnl >= 0 ? 'profit' : 'loss');

        // Account Cards
        document.getElementById('sub0Equity').textContent = '$' + data.account.sub0Equity.toLocaleString();
        document.getElementById('sub1Equity').textContent = '$' + data.account.sub1Equity.toLocaleString();
        document.getElementById('totalLeverage').textContent = ((data.account.leverage.sub0 + data.account.leverage.sub1) / 2).toFixed(2) + 'x';
        // Free collateral not in state, omit or calculate if possible
        document.getElementById('freeCollateral').textContent = '--'; // Add if available

        // Open Positions Table
        const positionsBody = document.querySelector('#positionsTable tbody');
        positionsBody.innerHTML = '';
        data.openPositions.forEach(pos => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${pos.asset}</td>
            <td class="${pos.direction.toLowerCase()}">${pos.direction}</td>
            <td>${pos.strategy}</td>
            <td>${pos.entryPrice.toFixed(2)}</td>
            <td>${pos.currentPrice.toFixed(2)}</td>
            <td class="${pos.unrealizedPnl >= 0 ? 'profit' : 'loss'}">${pos.unrealizedPnl.toFixed(2)}</td>
            <td>${pos.stopLoss ? pos.stopLoss.toFixed(2) : '--'}</td>
            <td>${pos.takeProfit ? pos.takeProfit.toFixed(2) : '--'}</td>
            <td>${pos.subaccount}</td>
          `;
          positionsBody.appendChild(row);
        });

        // Orders Table
        const ordersBody = document.querySelector('#ordersTable tbody');
        ordersBody.innerHTML = '';
        data.orders.forEach(order => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${order.asset}</td>
            <td>${order.type}</td>
            <td class="${order.direction.toLowerCase()}">${order.direction}</td>
            <td>${order.triggerPrice.toFixed(2)}</td>
            <td>${order.triggerCondition}</td>
            <td>${order.size.toFixed(4)}</td>
          `;
          ordersBody.appendChild(row);
        });

        // Trade History - assuming empty, but fetch if exists
        const historyBody = document.querySelector('#historyTable tbody');
        historyBody.innerHTML = '<tr><td colspan="7" style="text-align:center">No trade history available</td></tr>';
        // If fetching max2-trade-log.json:
        // const logResponse = await fetch('max2-trade-log.json');
        // const logData = await logResponse.json();
        // logData.forEach(trade => { ... });

      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    // Initial load
    loadData();

    // Auto-refresh every 60 seconds
    setInterval(loadData, 60000);
  </script>
</body>
</html>
